(()=>{var x=(d,e)=>()=>(d&&(e=d(d=0)),e);var O={};var A=x(()=>{new EventSource("/esbuild").addEventListener("change",d=>{let{added:e,removed:t,updated:n}=JSON.parse(d.data);if(!e.length&&!t.length&&n.length===1)for(let r of Array.from(document.getElementsByTagName("link"))){let i=new URL(r.href);if(i.host===location.host&&i.pathname===n[0]){let a=r.cloneNode();a.href=`${n[0]}?${Math.random().toString(36).slice(2)}`,a.onload=()=>r.remove(),r.parentNode.insertBefore(a,r.nextSibling);return}}location.reload()})});var p=class{constructor(...e){this.colorStops=e}toRgb(e,t){let[n,r,i,a]=e,o=[n,r,i].join(" "),s=t&&a!==void 0?` / ${a}`:"";return`rgb(${o}${s})`}create(e,t,...n){let[r,i,,a]=n,o=e.createLinearGradient(r,i,0,a);for(let[s,l]of this.colorStops)o.addColorStop(s,this.toRgb(l,t));return o}render(e,t,...n){let r=this.create(e,t,...n);e.save(),e.fillStyle=r,e.fillRect(...n),e.restore()}};var y=class extends p{constructor(){super([0,[15,3,40,1]],[1,[31,29,52,1]])}};var w;(n=>(n.easeIn=(r,i=1.67)=>r**i,n.easeOut=(r,i=1.67)=>1-Math.max(1-r,0)**i,n.easeInOut=r=>.5*(Math.sin((r-.5)*Math.PI)+1)))(w||(w={}));var u=class{constructor(e){this.debug=(...e)=>this.console.debug(...e);this.info=(...e)=>this.console.info(...e);this.warn=(...e)=>this.console.warn(...e);this.error=(...e)=>this.console.error(...e);this.console=e!=null?e:console}};var f=class{constructor(e,t=new u){this.logger=t;this.image=null;this.config={...e}}static loadImageAsync(e){return new Promise((t,n)=>{let r=new Image;r.onload=()=>t(r),r.onerror=(i,a,o,s,l)=>n(l!=null?l:new Error(`Image failed to load: ${e}`)),r.src=e})}get size(){return[...this.config.size]}set size(e){this.config.size=[...e]}async initAsync(){return this.image=await f.loadImageAsync(this.config.url),this}createFrameRenderer(e){let t=0,n=!1,r=.8;return i=>{if(t<1){let c=Math.min(w.easeInOut(i*6e-5),1);t=c>t?c:1}else n||(this.logger.debug("Logo animation done",i,t),n=!0);let[a,o]=this.size,s=Math.min(a,o)*t*r,l=[s,s],m=[...[(a-s)/2,(o-s)/(1.52+.68*t)],...l];return e.drawImage(this.image,...m),!0}}};var v;(e=>{function d(...t){return t.reduce((n,r)=>n+r/t.length,0)}e.avg=d})(v||(v={}));var S=class{constructor(e,t){this.cbRenderFrame=e;this.cbStopped=t;this.started=!1;this.currAnimationFrame=null}start(){let e=!this.started,t=n=>{var r;this.started&&(this.started=this.cbRenderFrame(n)),this.started?this.currAnimationFrame=requestAnimationFrame(t):(r=this.cbStopped)==null||r.call(this)};return this.started=!0,this.currAnimationFrame=requestAnimationFrame(t),e}stop(){var t;let e=this.started;return this.started=!1,this.currAnimationFrame&&cancelAnimationFrame(this.currAnimationFrame),e&&((t=this.cbStopped)==null||t.call(this)),e}};var F=class{constructor(e){this.horizontalLines=[];this.verticalLines=[];this.canvasAnimation=null;this.config={...this.getDefaultOptions(),...e!=null?e:{}},this.createVerticalLines(),this.createHorizontalLines()}get center(){let[e,t]=this.size;return[e/2,t/2]}get lineWidth(){return v.avg(...this.config.size)*.001*this.config.lineScaling}getDefaultOptions(){return{size:[960,540],fieldOfView:512,viewDistance:12,angle:-75,gridSize:12,lineScaling:1}}rotateX(...e){let[t,n]=e,{angle:r,fieldOfView:i,viewDistance:a}=this.config,o=r*Math.PI/180,s=Math.cos(o),l=Math.sin(o),g=n*s,m=n*l,c=i/(a+m);return t=t*c+this.center[0],n=g*c+this.center[1],[t,n]}createVerticalLines(){let{gridSize:e}=this.config,t,n;this.verticalLines.splice(0);for(let r=-e;r<=e;r++)t=this.rotateX(r,-e),n=this.rotateX(r,e),this.verticalLines.push([t,n])}createHorizontalLines(e=0){let{gridSize:t}=this.config,n,r;this.horizontalLines.splice(0);for(let i=-t;i<=t;i++)n=this.rotateX(-t,i+e/100),r=this.rotateX(t,i+e/100),this.horizontalLines.push([n,r])}drawCanvasLine(e,t,n){let[r,i]=t;e.save(),e.lineWidth=this.lineWidth,e.beginPath(),e.moveTo(...r),e.lineTo(...i),e.strokeStyle=n,e.closePath(),e.stroke(),e.restore()}toSvgLine(e,t,n="  "){let[[r,i],[a,o]]=e;return`${n}<line x1="${r}" y1="${i}" x2="${a}" y2="${o}" stroke="${t}"/>`}get size(){return[...this.config.size]}set size(e){this.config.size=e}get angle(){return this.config.angle}set angle(e){this.config.angle=e}get fieldOfView(){return this.config.fieldOfView}set fieldOfView(e){this.config.fieldOfView=e}renderToCanvas(e,t,n){n&&e.clearRect(0,0,...this.size);for(let r of this.verticalLines)this.drawCanvasLine(e,r,t.verStrokeStyle);for(let r of this.horizontalLines)this.drawCanvasLine(e,r,t.horStrokeStyle)}toSvg(e){let[t,n]=this.size;return[`<svg width="${t}" height="${n}" xmlns="http://www.w3.org/2000/svg">`,...this.verticalLines.map(r=>this.toSvgLine(r,e.verStrokeStyle)),...this.horizontalLines.map(r=>this.toSvgLine(r,e.horStrokeStyle)),"</svg>"].join(`
`)}createFrameRenderer(e,t){let n=0,r=0,i=0;return a=>{var m,c;let o=a-r,s=o/1e3*((m=t.rotateDegPerSecond)!=null?m:0);this.angle+=s%360;let l=!0;r=a;let g=o*((c=t.gridRowsPerSecond)!=null?c:3)/10;return this.createVerticalLines(),this.createHorizontalLines(n),this.renderToCanvas(e,t,!t.skipClear),n+g>=100&&i++,i<0&&(l=!1),n=(n+g)%100,l}}startCanvasAnimation(e,t,n){return this.canvasAnimation=new S(this.createFrameRenderer(e,t),n),this.canvasAnimation.start()}stopCanvasAnimation(){var e,t;return(t=(e=this.canvasAnimation)==null?void 0:e.stop())!=null?t:!1}};var L=class extends p{constructor(){super([0,[26,4,48,0]],[.3,[26,4,48,0]],[.5,[7,1,10,.7]],[.6,[4,1,5,.99]],[.65,[1,1,1,1]],[.68,[4,1,7,.99]],[.78,[11,10,17,.7]],[1,[41,39,62,0]])}};var h=class{constructor(e){this.config={patternSizeFactor:.5,starScaling:1,...e},this.origSize=[...e.size],this.stars=h.createStars(this.config,this.patternSize)}get patternSize(){let[e,t]=this.size;return[e*this.config.patternSizeFactor,t*this.config.patternSizeFactor]}get scaling(){return[this.size[0]/this.origSize[0],this.size[1]/this.origSize[1]]}get size(){return this.config.size}set size(e){this.config.size=[...e],this.animationState&&(this.animationState.pattern=this.createPattern(this.animationState.ctx))}static createStars(e,t){let n=[],[r,i]=t;for(let a=0;a<e.starCount;++a){let o=Math.random()*r,s=Math.random()*i,l=Math.random()*(v.avg(...e.size)*.001*e.starScaling);n.push([o,s,l])}return n}static renderStars(e,t,n){for(let r of e)t.beginPath(),t.arc(...r,0,2*Math.PI,!1),t.fillStyle=n,t.fill()}createPattern(e){let t=document.createElement("canvas");[t.width,t.height]=this.patternSize;let n=t.getContext("2d");return n.scale(...this.scaling),h.renderStars(this.stars,n,this.config.color),e.createPattern(t,"repeat")}createFrameRenderer(e,t){var a;let n=t.rotateDegPerSecond*(Math.PI/180);this.animationState={ctx:e,pattern:this.createPattern(e)};let[r,i]=(a=t.rotateCenterFactors)!=null?a:[.5,.65];return o=>{let s=o/1e3*n%(Math.PI*2),[l,g]=this.size;e.save(),e.translate(l*r,g*i),e.rotate(s),e.beginPath();let m=Math.sqrt((l*Math.max(r,1-r))**2+(g*Math.max(i,1-i))**2);return e.arc(0,0,m,0,2*Math.PI),e.fillStyle=this.animationState.pattern,e.fill(),e.strokeStyle="#FFF",e.stroke(),e.restore(),!0}}};var b;(i=>{let d=new u;function e(a,o){let s=null,l=()=>{s&&(clearTimeout(s),s=null),o==null||o.removeEventListener("abort",l),d.debug("Delay aborted")};return new Promise(g=>{s=setTimeout(g,a),o==null||o.addEventListener("abort",l)})}i.delayAsync=e;let t,n;function r(a,o){t=a,n&&n.abort("debounced"),n=new AbortController,e(o,n.signal).then(t)}i.debounce=r})(b||(b={}));IS_DEVELOPMENT&&Promise.resolve().then(()=>(A(),O));var P=class{constructor(e,...t){this.onWindowResize=e=>{b.debounce(async()=>{let t=this.assets;if(t){await b.delayAsync(200);let n=this.getContainerSize(),[,r]=this.size=t.grid.size=t.logo.size=t.starField.size=[this.ctx.canvas.width,this.ctx.canvas.height]=n;t.grid.fieldOfView=r/2}},250)};let n=typeof e=="string"?document.querySelector(e):e;if(!n)throw new Error("Invali container argument");this.container=n;let[r,i]=this.size=this.getContainerSize();this.ctx=this.appendCanvas(...this.size),this.assets={bg:new y,shadow:new L,starField:new h({size:this.size,patternSizeFactor:.5,starCount:360,starScaling:1,color:"rgb(255 255 255 / .6)"}),grid:new F({size:this.size,viewDistance:26,gridSize:23,angle:285,fieldOfView:i/2,lineScaling:1}),logo:new f({url:"./images/bare_saa_80_logo_nobg.svg",size:[r,i]})},this.ctorPromise=this.assets.logo.initAsync()}appendCanvas(e,t){let n=document.createElement("canvas");n.width=e,n.height=t,this.container.appendChild(n);let r=n.getContext("2d");return r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r}getContainerSize(){return[window.innerWidth,window.innerHeight]}async startAnimation(){await this.ctorPromise,window.addEventListener("resize",this.onWindowResize);let{bg:e,shadow:t,starField:n,grid:r,logo:i}=this.assets,a=n.createFrameRenderer(this.ctx,{rotateDegPerSecond:-3,rotateCenterFactors:[.5,.65]}),o=r.createFrameRenderer(this.ctx,{horStrokeStyle:"rgb(97 161 172 / .42)",verStrokeStyle:"rgb(255 255 255 / .15)",gridRowsPerSecond:2,rotateDegPerSecond:0,skipClear:!0}),s=i.createFrameRenderer(this.ctx),l=3e3;new S(m=>{let c=this.ctx,[R,C]=this.size,z=!0;return c.clearRect(0,0,c.canvas.width,c.canvas.height),e.render(c,!1,0,0,R,C),z=a(m),c.save(),c.translate(0,C/4.25),z=o(m),c.restore(),c.save(),c.rotate(Math.PI),c.translate(-R,C*-1.06),z=o(m),c.restore(),t.render(c,!0,0,0,R,C),m>l&&s(m-l),z}).start()}};new P(document.body,window.innerWidth,window.innerHeight).startAnimation();})();
//# sourceMappingURL=index.js.map
